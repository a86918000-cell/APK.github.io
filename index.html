<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>èŠå¤©å•Ÿå‹•å™¨ â€” ç´” HTML ç¯„ä¾‹</title>
  <meta name="description" content="ç´” HTML çš„èŠå¤©æ‡‰ç”¨å•Ÿå‹•å™¨ï¼šå°åœ–ç¤ºã€æœªè®€ç´…é»ã€é»æ“Šä»¥ URL scheme é–‹å•Ÿ Appã€ç¶²é é€šçŸ¥ï¼ˆéœ€æˆæ¬Šï¼‰ã€‚">
  <style>
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --muted: #70757a;
      --accent: #0a84ff;
      --danger: #ff3b30;
      --radius: 14px;
      --gap: 12px;
      --phone-width: 360px;
      --shadow: 0 8px 24px rgba(12,20,40,0.06);
      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:var(--font);color:#111}
    .container{max-width:860px;margin:28px auto;padding:20px;}
    h1{margin:0 0 6px 0;font-size:20px;font-weight:600}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .phone{width:var(--phone-width);margin:20px auto;background:linear-gradient(180deg,#fff,#fbfdff);border-radius:20px;padding:14px;box-shadow:var(--shadow)}
    .topbar{height:8px;background:linear-gradient(90deg,#eee,#f5f5f5);border-radius:6px;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .app{display:flex;align-items:center;gap:12px;padding:12px;background:var(--card);border-radius:12px;cursor:pointer;position:relative;box-shadow:0 6px 18px rgba(12,20,40,0.04);transition:transform .12s}
    .app:active{transform:translateY(1px)}
    .icon{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:26px;background:linear-gradient(180deg,#fafafa,#f0f4ff);box-shadow:inset 0 -2px 6px rgba(0,0,0,0.02)}
    .meta{flex:1;min-width:0}
    .name{font-weight:600;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .sub{font-size:12px;color:var(--muted);margin-top:6px}
    .badge{position:absolute;right:12px;top:12px;min-width:22px;height:22px;padding:0 7px;border-radius:999px;background:var(--danger);color:white;font-weight:700;font-size:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 12px rgba(255,59,48,0.12)}
    .controls{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:14px}
    button{padding:9px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer}
    .btn-ghost{background:#fff;border:1px solid #eee;color:#333}
    .note{font-size:13px;color:var(--muted);text-align:center;margin-top:10px}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    /* responsive */
    @media (max-width:420px){
      .phone{width:92%}
      .grid{grid-template-columns:repeat(1,1fr)}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>èŠå¤©å•Ÿå‹•å™¨ï¼ˆç´” HTMLï¼‰</h1>
    <p class="lead">é›†ä¸­å¸¸ç”¨èŠå¤© Appï¼Œé¡¯ç¤ºæœªè®€ç´…é»ï¼Œé»æ“Šè‡ªå‹•å˜—è©¦é–‹å•Ÿè©² Appï¼ˆURL schemeï¼‰ã€‚</p>

    <div class="phone" role="region" aria-label="èŠå¤©å•Ÿå‹•å™¨ç¤ºæ„">
      <div class="topbar" aria-hidden="true"></div>
      <div id="appsGrid" class="grid" role="list" aria-label="èŠå¤©æ‡‰ç”¨åˆ—è¡¨"></div>

      <div class="controls">
        <button id="simulateBtn">æ¨¡æ“¬éš¨æ©Ÿè¨Šæ¯</button>
        <button id="clearAll" class="btn-ghost">æ¸…é™¤æ‰€æœ‰æœªè®€</button>
        <button id="reqPerm" class="btn-ghost">å•Ÿç”¨é€šçŸ¥</button>
      </div>
      <div class="note">æç¤ºï¼šè¦åœ¨æ‰‹æ©Ÿä¸Šä½¿ç”¨ App è·³è½‰åŠŸèƒ½ï¼Œéœ€åœ¨æ‰‹æ©Ÿç€è¦½å™¨é–‹å•Ÿæ­¤é ä¸¦å…è¨±é€šçŸ¥ã€‚</div>
    </div>

    <footer>ä½¿ç”¨èªªæ˜ï¼šæœ¬é ç‚ºç´”å‰ç«¯ç¤ºç¯„ï¼Œè‹¥è¦æ¥æ”¶çœŸå¯¦è¨Šæ¯éœ€ç”±å¾Œç«¯æˆ–æ¨æ’­ä¼ºæœå™¨å‘¼å« <code>markUnread(appId, from, message)</code>ã€‚</footer>
  </div>

<script>
/* === Config: å®šç¾©ä½ è¦èšåˆçš„ App åˆ—è¡¨ ===
   id: å”¯ä¸€è­˜åˆ¥
   name: é¡¯ç¤ºåç¨±
   icon: å¯ç”¨ emoji æˆ–å°åœ–ç¤º
   scheme: URL scheme å˜—è©¦é–‹å•Ÿ appï¼ˆæ‰‹æ©Ÿä¸Šæœ‰æ•ˆï¼‰
   webUrl: fallback ç¶²å€ï¼ˆè‹¥æ²’æœ‰å®‰è£ appï¼‰
   deepPath: å¯é¸ï¼Œæƒ³è·³çš„ç‰¹å®šå°è±¡ pathï¼ˆç”±ä½ ç®¡ç†ï¼‰
*/
const apps = [
  { id: 'whatsapp', name: 'WhatsApp', icon: 'ğŸŸ¢', scheme: 'whatsapp://', webUrl: 'https://web.whatsapp.com/' },
  { id: 'line', name: 'LINE', icon: 'ğŸ’š', scheme: 'line://', webUrl: 'https://line.me' },
  { id: 'telegram', name: 'Telegram', icon: 'âœˆï¸', scheme: 'tg://', webUrl: 'https://web.telegram.org/' },
  { id: 'messenger', name: 'Messenger', icon: 'ğŸ’¬', scheme: 'fb-messenger://', webUrl: 'https://www.messenger.com/' },
  { id: 'tinder', name: 'Tinder', icon: 'ğŸ”¥', scheme: 'tinder://', webUrl: 'https://tinder.com/' },
  { id: 'demo', name: 'ç«™å…§èŠå¤©å®¤ï¼ˆç¯„ä¾‹ï¼‰', icon: 'ğŸ“¨', scheme: '', webUrl: '' }
];

// localStorage state
const LS_KEY = 'chat_launcher_state_v1';
const saved = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
const state = {};
apps.forEach(a => state[a.id] = saved[a.id] || { unread: 0, history: [] });

// utilities
function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

// render
const grid = document.getElementById('appsGrid');
function render(){
  grid.innerHTML = '';
  apps.forEach(a => {
    const item = document.createElement('div');
    item.className = 'app';
    item.setAttribute('role','button');
    item.setAttribute('aria-label', a.name);
    item.onclick = () => openApp(a);

    const icon = document.createElement('div'); icon.className='icon'; icon.textContent = a.icon; item.appendChild(icon);

    const meta = document.createElement('div'); meta.className='meta';
    const nm = document.createElement('div'); nm.className='name'; nm.textContent = a.name; meta.appendChild(nm);
    const sub = document.createElement('div'); sub.className='sub';
    const last = state[a.id].history.length ? state[a.id].history[state[a.id].history.length-1] : null;
    sub.textContent = last ? ('æœ€å¾Œï¼š' + last.text) : 'ç›®å‰æ²’æœ‰æ–°è¨Šæ¯';
    meta.appendChild(sub);
    item.appendChild(meta);

    if (state[a.id].unread && state[a.id].unread > 0){
      const b = document.createElement('div'); b.className='badge'; b.textContent = state[a.id].unread>99?'99+':state[a.id].unread; item.appendChild(b);
    }
    grid.appendChild(item);
  });
}
render();

// open app - try scheme, fallback to webUrl. Also clears unread for that app.
function openApp(app){
  // clear unread
  state[app.id].unread = 0;
  saveState(); render();

  if (!app.scheme){
    // demo internal chat panel
    alert('é€™æ˜¯ç¯„ä¾‹å…§å»ºèŠå¤©å®¤ï¼Œè«‹è‡ªè¡Œæ›¿æ›æˆä½ è¦çš„å…§é æˆ– deep linkã€‚');
    return;
  }

  // Try opening via iframe method (works on many mobile browsers)
  const iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  document.body.appendChild(iframe);
  try{
    iframe.src = app.scheme;
  }catch(e){}
  setTimeout(()=> {
    document.body.removeChild(iframe);
    // fallback
    if (app.webUrl) window.open(app.webUrl, '_blank');
  }, 800);
}

// mark unread (call this from your backend or webhook to notify)
function markUnread(appId, from, message){
  if (!state[appId]) return;
  state[appId].unread = (state[appId].unread || 0) + 1;
  state[appId].history = state[appId].history || [];
  state[appId].history.push({ from: from || 'åŒ¿å', text: message || '(æœªæä¾›å…§å®¹)', ts: Date.now() });
  saveState(); render();

  // show system notification if allowed
  if ("Notification" in window && Notification.permission === 'granted'){
    const title = from ? `${from} åœ¨ ${apps.find(x=>x.id===appId).name} å‚³ä¾†è¨Šæ¯` : `åœ¨ ${apps.find(x=>x.id===appId).name} æ”¶åˆ°æ–°è¨Šæ¯`;
    const n = new Notification(title, { body: message || 'ä½ æœ‰ä¸€å‰‡æ–°è¨Šæ¯', silent: false });
    if (navigator.vibrate) navigator.vibrate([200,80,200]);
    n.onclick = () => {
      window.focus();
      const app = apps.find(x=>x.id===appId);
      if (app) openApp(app);
    };
  } else {
    // flash title
    flashTitle('ã€æ–°è¨Šæ¯ã€‘ ' + apps.find(x=>x.id===appId).name);
  }
}

// title flash helper
let origTitle = document.title;
let flashTimer = null;
function flashTitle(text){
  if (flashTimer) clearInterval(flashTimer);
  let show = true;
  flashTimer = setInterval(() => {
    document.title = show ? text : origTitle;
    show = !show;
  }, 700);
  setTimeout(()=> { clearInterval(flashTimer); document.title = origTitle; flashTimer = null; }, 6000);
}

// Request notification permission
document.getElementById('reqPerm').addEventListener('click', () => {
  if (!("Notification" in window)) return alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´é€šçŸ¥ API');
  Notification.requestPermission().then(res => {
    if (res === 'granted') alert('å·²å…è¨±é€šçŸ¥'); else alert('é€šçŸ¥æœªè¢«å…è¨±');
  });
});

// simulate incoming
document.getElementById('simulateBtn').addEventListener('click', () => {
  const a = apps[Math.floor(Math.random()*apps.length)];
  const msgs = ['å—¨ï¼','æœ‰äººåœ¨å—ï¼Ÿ','ç…§ç‰‡å·²å‚³é€','æƒ³ç´„å‡ºä¾†ï¼Ÿ','æ”¶åˆ°ï¼'];
  const m = msgs[Math.floor(Math.random()*msgs.length)];
  markUnread(a.id, 'å°æ˜', m);
});

// clear all
document.getElementById('clearAll').addEventListener('click', () => {
  apps.forEach(a => { state[a.id].unread = 0; state[a.id].history = []; });
  saveState(); render();
});

// Expose markUnread for external calls (e.g., backend via iframe postMessage)
window.markUnread = markUnread;
</script>
</body>
</html>
